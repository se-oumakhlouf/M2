# Examen Conception API 2024

</br>

- ## Partie 1 - Décrire une API - Cas d'usage :

- **User stories** :
    - En tant que *Serveur*, je souhaite *consulter les **commandes** saisies par les consommateurs* afin de *les modifier*
    - En tant que *Serveur*, je souhaite *imprimer une **commande*** afin de *lancer le travail en cuisine*
    - En tant que *Serveur*, je souhaite *consulter les détails de **paiements** d'une **commande*** afin de *les modifier*
    - En tant que *Serveur*, je souhaite *imprimer une facture relative à un paiement* afin de pouvoir le fournir à un Consommateur si besoin
    - En tant que *Serveur*, je souhaite *consulter la liste des **produits** vendus par le Restaurant* afin de *la modifier*

</br>

- **Aggregate roots** *(ressources)* :
    - Commande
    - Paiement
    - Produit

- </br>

- **End-points** :

    - **Paths** :
        - `/orders` :
            - tags : [commande]
            - `GET` : 
                - description : Récupération de toutes les commandes en cours
                - responses :
                    - '200' :
                        - description : Commandes récupérés avec succès
                        - content : List\<**Command**\>  
                    - '401' :
                        - description : appel de l'endpoint sans en avoir les droits
                        - content : "Appel non authorisé"
                    - '500' :
                        - content : "Erreur interne du serveur"

        - `/orders/{id}` :
            - tags : [commande]
            - `GET` :
                - description : Récupère une commande correspondant à l'id du path
                - responses : 
                    - '200' :
                        - description : Commande trouvé
                        - content : `Commande`
                    - '404' : 
                        - description : Commande non trouvé
                        - content : "L'ID {id} ne correspond pas à une commande"

        - `/orders/{id}` :
            - tags : [commande]
            - `PATCH` : 
                - description : Modifié une commande
                - requestBody : 
                    - schema : `CommandPatchDTO`
                - responses :
                    - '200' :
                        - description : Modification partielle effectué avec succès
                        - content : "Succès de la modification partielle"
                    - '404' : 
                        - description : Erreur de traitement car l'id en arguments ne correspond pas à une commande valide
                        - content : "Commande non trouvé"

        - `/orders/{id}/print` :
            - tags : [commande]
            - `POST` : 
                - description : Déclenche l'impression physique de la commande pour lancer le travail en cuisine
                - responses :
                    - '202' :
                        - description : Demande d'impression acceptée (traitement asynchrone).
                        - content : "Impression lancée"
                    - '404' :
                        - description : Commande introuvable.

        - `/payments/{orderId}` :
            - tags : [paiement]
            - `GET` :
                - description : Consulter le détail des paiements réalisés pour une commande spécifique
                - responses :
                    - '200' :
                        - description : Détails des paiements récupérés.
                        - content : List\<**Paiement**\>
                    - '404' :
                        - description : Commande introuvable.

        - `/payments/{id}` :
            - tags : [paiement]
            - `PATCH` :
                - description : Modifier les informations d'un paiement existant
                - requestBody :
                    - schema : `Paiement` (partiel)
                - responses :
                    - '200' :
                        - description : Paiement mis à jour avec succès.

        - `/payments/{id}/invoice` :
            - tags : [paiement]
            - `POST` :
                - description : Générer et imprimer la facture relative à un paiement
                - responses :
                    - '201' :
                        - description : Facture créée et envoyée à l'impression.
                        - content : Lien vers le PDF (optionnel)

        - `/products` :
            - tags : [produit]
            - `GET` :
                - description : Consulter la liste des produits vendus et les stocks potentiels
                - responses :
                    - '200' :
                        - description : Catalogue récupéré avec succès.
                        - content : List\<**Produit**\>

        - `/products/{id}` :
            - tags : [produit]
            - `PUT` :
                - description : Mettre à jour un produit ou son stock
                - requestBody :
                    - schema : `Produit`
                - responses :
                    - '200' :
                        - description : Produit mis à jour.

    </br>

    - **Schemas** :
        - Commande :
            - description : Regroupe les produits choisis par une table et son statut de préparation
            - propriétées : 
                - commandeID :
                    - type : UUID
                    - example : fea18-dadeb-azadaz-198abza-bf87As
                    - description : identifiant unique de la commande
                - tableName :
                    - type : String
                    - example : Table_12
                    - description : nom de la table dans la salle
                - statut : 
                    - type : Enum {CREATION, EN_PREPARATION, A_LIVRER, LIVRER}
                    - description : Représente le status d'une commande pour suivre sa progression
                - produits :
                    - type : List\<**ProduitIDs**\>
                    - description : Regroupe les ID des produits choisis par les consommateurs dans cette commande
                    - example : [fea18-dadeb-azadaz-198abza-bf87Zs, fea18-dadeb-azadaz-198abza-bf87Ws]

        - CommandPatchDTO :
            - description : Objet reçu par API contenant les champs à modifier d'une commande
            - propriétées :
                - tableName :
                    - type : String
                    - example : Table_12
                    - description : nom de la table dans la salle
                - statut : 
                    - type : Enum {CREATION, EN_PREPARATION, A_LIVRER, LIVRER}
                    - description : Représente le status d'une commande pour suivre sa progression
                - produits :
                    - type : List\<**ProduitIDs**\>
                    - description : Regroupe les ID des produits choisis par les consommateurs dans cette commande
                    - example : [fea18-dadeb-azadaz-198abza-bf87Zs, fea18-dadeb-azadaz-198abza-bf87Ws]

        - Produit :
            - description : Représente un élément proposé dans le menu et sa disponibilité
            - propriétées :
                - productID :
                    - type : UUID
                    - example : fea18-dadeb-azadaz-198abza-bf87Bs
                    - description : identifiant unique du produit
                - productName : 
                    - type : String
                    - example : "Poulet au Champignons", "Oasis", "Crème Brûlée"
                    - description : nom du produit sur le menu
                - price :
                    - type : float
                    - example : 9,99
                    - description : prix en Euros (€) d'un produit
                - productDescription :
                    - type : String
                    - example : "Escalope de Poulet accompagnée d'une sauce aux champignons avec du riz et des légumes"
                    - description : description de la composition du produit
                - stock :
                    - type : long
                    - example : 25
                    - description : quantité disponible dans les stocks

        - Paiement :
            - description : détails financiers associés à une commande
            - propriétées :
                - id : 
                    - type : UUID
                    - example : fea18-dadeb-azadaz-198abza-bf87Cs
                    - description : identifiant unique du paiement
                - orderID : 
                    - type : UUID
                    - description : référence vers la commande concernée
                - price : 
                    - type : double
                    - description : montant total en euros (€)
                    - example : 42,90
                - status :
                    - type : Enum {EN_COURS, PAYER, REMBOURSER}
                    - description : status du paiement
                - method :
                    - type : String
                    - description : moyen de paiement utilisé
                    - example : "Application Mobile"
                
</br>

- ## Résilience et Sécurisation :

    - **Sécurisation des échanges** :
        - **OAuth2** : Mise en place d'un flux d'authentification (Client Credentials Flow) pour valider que seuls les terminaux serveurs autorisés accèdent à l'API.
        
        - **HTTPS (TLS)** : Chiffrement obligatoire de tous les échanges pour protéger les données sensibles (paiements).

    - **Gestion de la résilience** :
        - **Idempotence** : Utilisation d'une clé d'idempotence (header `Idempotency-Key`) sur les verbes `POST` (notamment `/print` et `/invoice`) pour éviter les doublons en cas de problème réseau.

        - **Circuit Breaker** : Mise en place d'un coupe-circuit sur les appels aux services externes (Service d'impression, Service Bancaire). Si le service échoue de façon répétée, l'API répondra immédiatement par une erreur contrôlée (ou un mode dégradé) sans attendre le timeout.

</br>

- ## Partie 2 - QCM :

    - **Q1 - Concernant le protocole oAuth2** :
        - [x] Réponse B - oAuth2 permet d'autoriser la consommation de ressources d'une application Serveur

    - **Q2 - Quelle définition s'applique au principe de Circuit Breaker ?** :
        - [x] Réponse D - Exécuter un traitement de remplacement en cas d'indisponibilité d'une partie d'un service

    - **Q3 - Concernant le Domain Driven Design, quelles sont les notions essentielles** :
        - [x] Réponse A - Identifier des Bounded Context
        - [x] Réponse C - Définir un langage commun

    - **Q4 - Parmi les définitions de verbes http, lesquelles sont correctes ?** :
        - [x] Réponse A - GET - Permet de consulter une ressource